const e=new class{constructor(){this.initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.startButton=document.querySelector(".button"),this.scoreboard=document.querySelector(".game-score"),this.board=[],this.cellHistory=[],this.status="idle"}move(e){if("playing"===this.getStatus()){this.cellHistory=[];let t=JSON.stringify(this.board);switch(e){case"left":this.moveLeft(this.board);break;case"right":this.moveRight(this.board);break;case"up":this.moveUp(this.board);break;case"down":this.moveDown(this.board)}if(JSON.stringify(this.board)!==t)this.addRandomCell(),this.displayGame();else{let e=JSON.parse(JSON.stringify(this.board)),s=this.getEmptyCell();this.moveLeft(e),this.moveRight(e),this.moveUp(e),this.moveDown(e),s.length||JSON.stringify(e)!==t||this.setStatus("lose")}}}moveLeft(e){for(let t=0;t<e.length;t++){let s=0;for(let o=0;o<e.length;o++)if(0!==e[t][o]){let r=e[t][o];if(s!==o&&(this.cellHistory.push({value:r,oldCoords:{X:o,Y:t},newCoords:{X:s,Y:t},move:!0}),e[t][s]=r,e[t][o]=0),s>0&&e[t][s]===e[t][s-1]){let o=2*e[t][s],r=this.cellHistory[this.cellHistory.length-1];r&&r.newCoords.Y===t&&r.newCoords.X===s?(r.merge=!0,r.newCoords.X=s-1,r.problem=!0):this.cellHistory.push({value:o,oldCoords:{Y:t,X:s},newCoords:{Y:t,X:s-1},merge:!0}),e[t][s-1]=o,e[t][s]=0,s--}s++}}return e}moveRight(e){for(let t=0;t<e.length;t++){let s=e.length-1;for(let o=e.length-1;o>=0;o--)if(0!==e[t][o]){let r=e[t][o];if(s!==o&&(this.cellHistory.push({value:r,oldCoords:{Y:t,X:o},newCoords:{Y:t,X:s},move:!0}),e[t][s]=r,e[t][o]=0),s<e.length-1&&e[t][s]===e[t][s+1]){let o=2*e[t][s],r=this.cellHistory[this.cellHistory.length-1];r&&r.newCoords.Y===t&&r.newCoords.X===s?(r.merge=!0,r.newCoords.X=s+1):this.cellHistory.push({value:o,oldCoords:{Y:t,X:s},newCoords:{Y:t,X:s+1},merge:!0}),e[t][s+1]=o,e[t][s]=0,s++}s--}}return e}moveUp(e){for(let t=0;t<e.length;t++){let s=0;for(let o=0;o<e.length;o++)if(0!==e[o][t]){let r=e[o][t];if(s!==o&&(this.cellHistory.push({value:r,oldCoords:{Y:o,X:t},newCoords:{Y:s,X:t},move:!0}),e[s][t]=r,e[o][t]=0),s>0&&e[s][t]===e[s-1][t]){let o=2*e[s][t],r=this.cellHistory[this.cellHistory.length-1];r&&r.newCoords.Y===s&&r.newCoords.X===t?(r.merge=!0,r.newCoords.Y=s-1):this.cellHistory.push({value:o,oldCoords:{Y:s,X:t},newCoords:{Y:s-1,X:t},merge:!0}),e[s-1][t]=o,e[s][t]=0,s--}s++}}return e}moveDown(e){for(let t=0;t<e.length;t++){let s=e.length-1;for(let o=e.length-1;o>=0;o--)if(0!==e[o][t]){let r=e[o][t];if(s!==o&&(this.cellHistory.push({value:r,oldCoords:{Y:o,X:t},newCoords:{Y:s,X:t},move:!0}),e[s][t]=r,e[o][t]=0),s<e.length-1&&e[s][t]===e[s+1][t]){let l=2*e[s][t],a=this.cellHistory[this.cellHistory.length-1];a&&a.newCoords.Y===s&&a.newCoords.X===t?(a.merge=!0,a.newCoords.Y=s+1):this.cellHistory.push({value:r,oldCoords:{Y:o,X:t},newCoords:{Y:s+1,X:t},merge:!0}),e[s+1][t]=l,e[s][t]=0,s++}s--}}return e}getScore(){let e=0;for(let t of this.board)e+=t.reduce((e,t)=>e+t,0);return e}setStatus(e){switch(e){case"playing":this.status="playing",this.setMessage();break;case"idle":this.status="idle",this.setMessage("start");break;case"win":this.status="win",this.setMessage("win");break;case"lose":this.status="lose",this.setMessage("lose")}}getState(){return this.board}getStatus(){return this.status}start(){this.startButton.textContent="Restart",this.startButton.className="button restart",this.setStatus("playing"),this.board=JSON.parse(JSON.stringify(this.initialState)),this.addRandomCell(),this.addRandomCell(),this.displayGame()}setMessage(e){let t=document.querySelector(".message-win"),s=document.querySelector(".message-lose"),o=document.querySelector(".message-start");switch(s.className="message message-lose hidden",o.className="message message-start hidden",t.className="message message-win hidden",e){case"win":t.className="message message-win";break;case"lose":s.className="message message-lose";break;case"start":o.className="message message-start"}}restart(){this.clearBoard(),this.cellHistory=[],this.setStatus("idle"),this.startButton.textContent="Start",this.startButton.className="button start",this.scoreboard.textContent=0}getEmptyCell(){let e=[];for(let t=0;t<this.board.length;t++)for(let s=0;s<this.board.length;s++)this.board[t][s]||e.push({x:s,y:t});return e}addRandomCell(){let e=this.getEmptyCell();if(e.length>0){let t=Math.floor(Math.random()*e.length),s=e[t];this.board[s.y][s.x]=.9>Math.random()?2:4,this.cellHistory.push({value:this.board[s.y][s.x],newCoords:{X:s.x,Y:s.y},newCell:!0})}}displayGame(){this.displayAnimateBoard(),this.scoreboard.textContent=this.getScore()}displayAnimateBoard(){for(let e of this.cellHistory){let t=document.querySelector(".move-zone");if(e.newCell){let s=document.createElement("div");t.appendChild(s),s.textContent=e.value,s.className=`moving-block field-cell--${e.value}`,s.id=`cell${e.newCoords.Y}${e.newCoords.X}`,s.style.setProperty("--y",e.newCoords.Y),s.style.setProperty("--x",e.newCoords.X);let o=[{transform:"scale(1)"},{transform:"scale(1.56)"},{transform:"scale(1)"}],r={duration:400,iterations:1,easing:"ease-in-out"};s.animate(o,r)}else if("playing"===this.getStatus()){let t=document.getElementById(`cell${e.oldCoords.Y}${e.oldCoords.X}`),s=`cell${e.newCoords.Y}${e.newCoords.X}`;document.querySelector("#"+s)&&document.querySelector("#"+s).remove(),t.id=s,t.className=`moving-block field-cell--${this.board[e.newCoords.Y][e.newCoords.X]}`,t.textContent=this.board[e.newCoords.Y][e.newCoords.X],t.style.setProperty("--y",e.newCoords.Y),t.style.setProperty("--x",e.newCoords.X)}}}nonAnimateUpdateBoard(){this.clearBoard();for(let e=0;e<this.board.length;e++)for(let t=0;t<this.board.length;t++)if(0!==this.board[e][t]){let s=document.querySelector(`#cell${e}${t}`);s.textContent=this.board[e][t],s.className=`field-cell field-cell--${this.board[e][t]}`}}clearBoard(){document.querySelectorAll(".moving-block").forEach(e=>{e.remove()})}},t=document.querySelector(".button"),s=document.querySelector("h1");t.onclick=()=>{"Start"===t.textContent?e.start():e.restart()},s.onclick=()=>{e.animation()},addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":e.move("up");break;case"ArrowDown":e.move("down");break;case"ArrowRight":e.move("right");break;case"ArrowLeft":e.move("left")}});
//# sourceMappingURL=index.9b96a677.js.map
